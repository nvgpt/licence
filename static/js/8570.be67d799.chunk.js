"use strict";(self.webpackChunklicencenow=self.webpackChunklicencenow||[]).push([[8570],{58570:(e,s,i)=>{i.r(s),i.d(s,{default:()=>y});var r=i(65043),t=i(73216),l=i(94745),o=i(53519),n=i(61072),a=i(78602),d=i(46978),c=i(26917),u=i(63401),b=(i(92342),i(69677)),h=i(30064),m=i.n(h),g=i(22740),_=i(8729),x=i(63393),v=i(70579);const j=(0,b.c)("pk_test_51Qx3GlFgIjlU5Y2bUsYduThBEtzpVghTlezzWPqAA7VuXNUvWZgp6s2r67h6xbZdCyZGzbVeVOn6eDJ8gKqmcK3k00hVDkb0p8");function N(e){let{learnerBookData:s,token:i,bookWithNewTrainerID:t,bookNow:l}=e;const o=(0,x.useStripe)(),n=(0,x.useElements)(),[a,b]=(0,r.useState)(!1);return(0,v.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),o&&n){b(!0);try{const e=l.client_key;if(!e)return u.oR.error("Failed to retrieve payment details from the server."),void b(!1);{const{error:i,paymentIntent:r}=await o.confirmCardPayment(e,{payment_method:{card:n.getElement(x.CardElement)}});i?(u.oR.error(`Payment failed: ${i.message}`),b(!1)):r&&"succeeded"===r.status?((async e=>{const r=Math.floor(9e9*Math.random())+1e9;try{const i=await(0,d.$P)(c.A.PAYNOW,{payment_status:!0,billing_name:s.billing_name,billing_address:s.billing_address,billing_suburb_id:s.billing_suburb_id,billing_state_id:s.billing_state_id,bookingNumber:r,learner_token:e.learner_token,billing_suburb:s.billing_suburb,billing_state_slug:s.billing_state_slug,billing_state_name:s.billing_state_name,billing_postcode:s.billing_postcode});i.success?m().fire({title:"Payment Successful!",text:"Your payment was successful.",html:`Your booking id is <b>${r}</b>`,icon:"success",timer:4e3,showConfirmButton:!1}).then((()=>{window.location.href="/learner/dashboard"})):u.oR.error(`${i.message}`)}catch(i){console.error("Payment submission error:",i)}})(l),b(!1)):(u.oR.warn("Payment status unknown. Please contact support."),b(!1))}}catch(r){var i;if(console.error("API call error:",r),r.response)u.oR.error((null===(i=r.response.data)||void 0===i?void 0:i.data.error)||r.response.statusText||"An error occurred with the request.");else r.request?u.oR.error("No response received from the server. Please try again."):u.oR.error("An unexpected error occurred. Please try again.")}finally{b(!1)}}else u.oR.error("Stripe has not loaded. Please try again.")},className:"RegistrationForm__field ",children:[(0,v.jsx)("label",{children:"Pay with debit/credit card"}),(0,v.jsx)(x.CardElement,{options:{hidePostalCode:!0}}),(0,v.jsxs)("label",{className:"stripe_label",children:[(0,v.jsx)("input",{type:"radio",defaultChecked:!0}),(0,v.jsx)("div",{className:"img_cover",children:(0,v.jsx)("img",{src:g})}),(0,v.jsx)("span",{children:" Pay with Stripe"})]}),(0,v.jsx)("button",{type:"submit",disabled:!o||a,className:"btn btn-blue",style:{width:"100%",maxWidth:"100%",borderRadius:"6px"},children:a?"Processing...":"CONFIRM: MAKE PAYMENT"})]})}const p=function(){const{learnerBookData:e,token:s,bookWithNewTrainerID:i,bookNow:r}=(0,_.A)();return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(x.Elements,{stripe:j,children:(0,v.jsx)(N,{learnerBookData:e,token:s,bookWithNewTrainerID:i,bookNow:r})}),(0,v.jsx)(u.N9,{})]})};var k=i(63324),f=i(71505);const y=function(){var e,s,i,u,b;const{learnerBookData:h,setLearnerBookData:m,bookWithNewTrainerID:g}=(0,_.A)(),x=((0,t.Zp)(),(0,t.zy)()),[j]=(0,r.useState)((null===(e=x.state)||void 0===e?void 0:e.bookTest)||!1),[N,y]=(0,r.useState)(""),[w,D]=(0,r.useState)([]),[B,P]=(0,r.useState)(!1),[A,R]=(0,r.useState)(!1),[S,F]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(!S&&""!==N.trim()){const e=setTimeout((()=>{T(N)}),500);return()=>clearTimeout(e)}}),[N,S]);const T=async e=>{P(!0),R(!1);try{const s=await(0,d.$P)(c.A.FIND_SUBURBS,{filter:e});if(s.success&&s.data){const i=s.data.filter((s=>[s.suburb,s.stateCode,s.postcode.toString()].some((s=>s.toLowerCase().includes(e.toLowerCase())))));R(0===i.length),D(i)}else D([]),R(!0)}catch(s){console.error("Error fetching suggestions:",s),D([]),R(!0)}finally{P(!1)}};return(0,r.useEffect)((()=>{(async()=>{try{const[e]=await Promise.all([(0,d.Vg)(c.A.STATES)]);null!==e&&void 0!==e&&e.data&&m((s=>({...s,allStaeList:e.data})))}catch(e){}})()}),[]),(0,v.jsx)("div",{children:(0,v.jsxs)("div",{className:"mainContent learnerDashboard",children:[(0,v.jsx)(l.A,{}),(0,v.jsx)("div",{className:"mainContent__assets",children:(0,v.jsx)(o.A,{children:(0,v.jsx)(n.A,{children:(0,v.jsxs)(a.A,{lg:12,children:[(0,v.jsx)("div",{className:"learnerDashboard__wrp",children:(0,v.jsx)("div",{className:"secIntro",children:(0,v.jsx)("div",{className:"secIntro__left"})})}),(0,v.jsxs)("div",{className:"bookNow__stepWrap d-flex",children:[(0,v.jsxs)("div",{className:"bookNow__stepWrapLeft",children:[(0,v.jsx)("h2",{children:"Pay for Booking"}),(0,v.jsxs)("div",{className:"RegistrationForm",children:[(0,v.jsxs)("div",{className:"bookNow__drivingLessons",style:{overflow:"visible"},children:[(0,v.jsx)("div",{className:"bookNow__drivingLessonsHead text-center text-black bg-light-grey",style:{borderRadius:"10px 10px 0 0"},children:(0,v.jsx)("h4",{style:{textAlign:"left"},children:"Enter Your Payment Details"})}),(0,v.jsxs)("div",{className:"learnerDashboard__bottom",children:[(0,v.jsxs)("div",{className:"RegistrationForm__group",children:[(0,v.jsxs)("div",{className:"RegistrationForm__field",children:[(0,v.jsx)("label",{htmlFor:"*Billing Name",children:"*Billing Name"}),(0,v.jsx)("input",{type:"text",name:"billing_name",id:"billing_name",value:null===h||void 0===h?void 0:h.billing_name,required:!0,onChange:e=>m((s=>({...s,billing_name:e.target.value})))})]}),(0,v.jsxs)("div",{className:"RegistrationForm__field",children:[(0,v.jsx)("label",{htmlFor:"*Billing Address",children:"*Billing Address"}),(0,v.jsx)(f.A,{setLearnerBookData:m})]})]}),(0,v.jsxs)("div",{className:"RegistrationForm__group",children:[(0,v.jsxs)("div",{className:"RegistrationForm__field",style:{position:"relative"},children:[(0,v.jsx)("label",{htmlFor:"*Suburb",children:"*Suburb"}),(0,v.jsx)("input",{type:"text",name:"billing_suburb_id",id:"billing_suburb_id",value:null===h||void 0===h?void 0:h.billing_suburb,required:!0,disabled:!0,readOnly:!0})]}),(0,v.jsxs)("div",{className:"RegistrationForm__field",children:[(0,v.jsx)("label",{htmlFor:"*State",children:"*State"}),(0,v.jsx)("input",{type:"text",name:"billing_suburb_id",id:"billing_suburb_id",value:null===h||void 0===h?void 0:h.billing_state_name,required:!0,disabled:!0,readOnly:!0})]})]})]})]}),(0,v.jsx)("hr",{}),h.billing_name&&h.billing_address&&(0,v.jsx)(p,{}),(0,v.jsx)("div",{className:"RegistrationForm__group",children:(0,v.jsx)("div",{className:"RegistrationForm__field"})})]})]}),(0,v.jsx)("div",{className:"bookNow__stepWrapRight",children:(0,v.jsxs)("div",{className:"bookNow__drivingLessons",children:[(0,v.jsx)("div",{className:"bookNow__drivingLessonsHead text-center text-black bg-light-grey",children:(0,v.jsx)("h4",{children:"Your Current Bookings"})}),(0,v.jsx)("div",{className:"bookNow__subTotal bg-white",children:h.lessonBookingData.length>0||h.totalTestPackagePrice>0?(0,v.jsxs)(v.Fragment,{children:[h.lessonBookingData.length>0&&(0,v.jsx)("div",{className:"learnerDashboard__bottom",children:(0,v.jsxs)("div",{className:"learnerDashboard__subTotalrow d-flex justify-content-between align-items-center",children:[(0,v.jsxs)("strong",{children:[null===h||void 0===h||null===(s=h.lessonBookingData)||void 0===s?void 0:s.length," x Driving Lesson",(null===h||void 0===h||null===(i=h.lessonBookingData)||void 0===i?void 0:i.length)>1?"s":"","( ",null===h||void 0===h?void 0:h.totalBookHours," Hour",(null===h||void 0===h?void 0:h.totalBookHours)>1?"s":"",")",(0,v.jsxs)("span",{children:[(0,k.A)(null===h||void 0===h||null===(u=h.lessonBookingData[0])||void 0===u?void 0:u.lesson_date),"\xa0",null===h||void 0===h||null===(b=h.lessonBookingData[0])||void 0===b?void 0:b.lesson_time]})]}),(0,v.jsxs)("p",{children:[" $",null===h||void 0===h?void 0:h.totalBookHourPrice]})]})}),(0,v.jsxs)("div",{className:"font-secondary bookNow__subTotalrow d-flex justify-content-between align-items-center border-dark",children:[(0,v.jsx)("strong",{children:"Subtotal"}),(0,v.jsxs)("strong",{children:["$",+(null===h||void 0===h?void 0:h.totalBookHourPrice)+0]})]}),(0,v.jsx)("div",{className:"font-secondary border-y-0 learnerDashboard__bottom bg-light-grey border-grey padding-sm",children:(0,v.jsxs)("div",{className:"learnerDashboard__subTotalrow d-flex justify-content-between align-items-center",children:[(0,v.jsx)("span",{className:"p-0",children:"Credit Applied"}),(0,v.jsx)("p",{children:"-$0.00"})]})}),(0,v.jsxs)("div",{className:"font-secondary bookNow__subTotalrow d-flex justify-content-between align-items-center",children:[(0,v.jsx)("h4",{children:"Total Amount"}),(0,v.jsxs)("h4",{children:["$",+(null===h||void 0===h?void 0:h.totalBookHourPrice)+0]})]})]}):(0,v.jsx)(v.Fragment,{children:(0,v.jsx)("div",{className:"learnerDashboard__bottom",children:(0,v.jsx)("h4",{children:"No lesson confirmed"})})})})]})})]})]})})})})]})})}}}]);
//# sourceMappingURL=8570.be67d799.chunk.js.map